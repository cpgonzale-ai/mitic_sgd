<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Documental Unificado - Gobierno Nacional</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- jsPDF para generación de PDFs y AutoTable para tablas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- Librería para generar el Código QR real -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <!-- Configuración Tailwind & Estilos -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af', // Azul Gobierno
                            900: '#1e3a8a',
                            950: '#172554',
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(59, 130, 246, 0.5)',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; }
        .animate-fadeIn { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-scaleIn { animation: scaleIn 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Glass effect utilities */
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS (SVG Components) ---
        const Icon = ({ d, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                {d}
            </svg>
        );

        const Icons = {
            FileText: (p) => <Icon {...p} d={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>} />,
            Search: (p) => <Icon {...p} d={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>} />,
            Plus: (p) => <Icon {...p} d={<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>} />,
            Filter: (p) => <Icon {...p} d={<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>} />,
            Download: (p) => <Icon {...p} d={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>} />,
            Upload: (p) => <Icon {...p} d={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>} />,
            CheckCircle: (p) => <Icon {...p} d={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            LinkIcon: (p) => <Icon {...p} d={<><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></>} />,
            FileCheck: (p) => <Icon {...p} d={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m9 15 2 2 4-4"/></>} />,
            QrCode: (p) => <Icon {...p} d={<><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></>} />,
            MoreVertical: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></>} />,
            Clock: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />,
            User: (p) => <Icon {...p} d={<><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
            Building: (p) => <Icon {...p} d={<><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="9" y1="22" x2="9" y2="22"/><line x1="15" y1="22" x2="15" y2="22"/><line x1="12" y1="22" x2="12" y2="22"/><line x1="12" y1="2" x2="12" y2="22"/><line x1="4" y1="10" x2="20" y2="10"/><line x1="4" y1="14" x2="20" y2="14"/><line x1="4" y1="18" x2="20" y2="18"/></>} />,
            ArrowRight: (p) => <Icon {...p} d={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />,
            ArrowLeft: (p) => <Icon {...p} d={<><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></>} />,
            ShieldCheck: (p) => <Icon {...p} d={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></>} />,
            FolderOpen: (p) => <Icon {...p} d={<><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2"/></>} />,
            Edit: (p) => <Icon {...p} d={<><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></>} />,
            Monitor: (p) => <Icon {...p} d={<><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></>} />,
            X: (p) => <Icon {...p} d={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />,
            Trash: (p) => <Icon {...p} d={<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>} />,
            ExternalLink: (p) => <Icon {...p} d={<><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></>} />,
            Home: (p) => <Icon {...p} d={<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>} />,
            Shield: (p) => <Icon {...p} d={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></>} />,
            CheckSquare: (p) => <Icon {...p} d={<><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></>} />,
            Square: (p) => <Icon {...p} d={<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>} />,
            Settings: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></>} />,
            ChevronDown: (p) => <Icon {...p} d={<polyline points="6 9 12 15 18 9"/>} />,
            ChevronRight: (p) => <Icon {...p} d={<polyline points="9 18 15 12 9 6"/>} />,
            PlusCircle: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></>} />,
            Save: (p) => <Icon {...p} d={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            Paperclip: (p) => <Icon {...p} d={<path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>} />,
            Eye: (p) => <Icon {...p} d={<><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></>} />,
            History: (p) => <Icon {...p} d={<><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></>} />,
            AlertTriangle: (p) => <Icon {...p} d={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>} />,
            Calendar: (p) => <Icon {...p} d={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>} />,
        };

        // --- COMPONENTES AUXILIARES UI ---

        const SidebarItem = ({ id, icon, label, active, onClick }) => {
            const IconComp = Icons[icon] || Icons.FileText;
            return (
                <button
                    onClick={() => onClick(id)}
                    className={`w-full flex items-center space-x-3 px-4 py-3 text-sm font-medium transition-all duration-200 rounded-lg mb-1 group text-left ${
                        active 
                            ? 'bg-brand-800 text-white shadow-md shadow-brand-900/20 translate-x-1' 
                            : 'text-slate-400 hover:bg-slate-800/50 hover:text-white hover:translate-x-1'
                    }`}
                >
                    <IconComp size={20} className={`shrink-0 ${active ? 'text-white' : 'text-slate-400 group-hover:text-white'} transition-colors`} />
                    <span className="leading-tight">{label}</span>
                </button>
            );
        };

        const Badge = ({ status }) => {
            const styles = {
                'Activo': 'bg-green-100 text-green-800 border-green-200',
                'Inactivo': 'bg-slate-100 text-slate-600 border-slate-200',
                'Firmado': 'bg-emerald-100 text-emerald-800 border-emerald-200',
                'Borrador': 'bg-amber-100 text-amber-800 border-amber-200',
                'Validado': 'bg-blue-100 text-blue-800 border-blue-200',
                'Guardado': 'bg-indigo-100 text-indigo-800 border-indigo-200',
                'Vigente': 'bg-green-100 text-green-800 border-green-200',
                'Seleccionado': 'bg-indigo-100 text-indigo-800 border-indigo-200'
            };
            return (
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-semibold border ${styles[status] || 'bg-slate-100 text-slate-800 border-slate-200'}`}>
                    {status}
                </span>
            );
        };

        const Card = ({ children, className = "", ...props }) => (
            <div className={`bg-white rounded-2xl shadow-soft border border-slate-100 p-6 ${className}`} {...props}>
                {children}
            </div>
        );

        const Button = ({ children, variant = 'primary', onClick, className = "", disabled = false }) => {
            const baseClass = "px-6 py-2.5 rounded-xl font-medium flex items-center justify-center gap-2 transition-all duration-300 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-gradient-to-r from-brand-700 to-brand-900 text-white shadow-lg shadow-brand-500/30 hover:shadow-brand-500/40 hover:-translate-y-0.5",
                secondary: "bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 hover:border-slate-300 shadow-sm",
                danger: "bg-red-50 text-red-600 border border-red-100 hover:bg-red-100",
                ghost: "text-slate-500 hover:text-slate-800 hover:bg-slate-100/50"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseClass} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        // --- VISTAS DEL SISTEMA ---

        const RepositoryView = ({ setActiveTab, documents, setDocuments, onlyUserDocs = false }) => {
            const [searchQuery, setSearchQuery] = useState('');
            const currentUser = 'Cynthia Gonzalez'; // Usuario actual simulado
            
            // Estado para filtros por columna
            const [columnFilters, setColumnFilters] = useState({
                title: '',
                type: '',
                keyword: '',
                author: '',
                date: '',
                institution: '',
                digitaliaId: '',
                status: ''
            });
            
            const [viewDoc, setViewDoc] = useState(null);
            const [editDoc, setEditDoc] = useState(null);
            const [deleteDoc, setDeleteDoc] = useState(null);

            const handleUpdateDoc = () => {
                if (editDoc) {
                    setDocuments(documents.map(d => d.id === editDoc.id ? editDoc : d));
                    setEditDoc(null);
                }
            };

            const handleDeleteConfirm = () => {
                if (deleteDoc) {
                    setDocuments(documents.filter(d => d.id !== deleteDoc.id));
                    setDeleteDoc(null);
                }
            };

            // Lógica de filtrado combinada
            const filteredDocs = documents.filter(doc => {
                const matchesGlobal = doc.title.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesTitle = doc.title.toLowerCase().includes(columnFilters.title.toLowerCase()) || doc.id.toLowerCase().includes(columnFilters.title.toLowerCase());
                const matchesType = (doc.type || '').toLowerCase().includes(columnFilters.type.toLowerCase());
                const matchesKeyword = (doc.keyword || '').toLowerCase().includes(columnFilters.keyword.toLowerCase());
                const matchesAuthor = doc.author.toLowerCase().includes(columnFilters.author.toLowerCase());
                const matchesDate = doc.date.includes(columnFilters.date);
                const matchesInst = (doc.institution || '').toLowerCase().includes(columnFilters.institution.toLowerCase());
                const matchesExp = (doc.digitaliaId || '').toLowerCase().includes(columnFilters.digitaliaId.toLowerCase());
                const matchesStatus = columnFilters.status === '' || doc.status === columnFilters.status;
                
                // Filtro específico para "Mi Dependencia"
                const matchesUser = onlyUserDocs ? doc.author === currentUser : true;

                return matchesGlobal && matchesTitle && matchesType && matchesKeyword && matchesAuthor && matchesDate && matchesInst && matchesExp && matchesStatus && matchesUser;
            });

            return (
                <div className="space-y-8 animate-fadeIn relative p-2">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-3xl font-bold text-slate-900 tracking-tight">{onlyUserDocs ? 'Mi Dependencia' : 'Repositorio Central'}</h2>
                            <p className="text-slate-500 mt-1">{onlyUserDocs ? 'Gestión de documentos creados por mi usuario' : 'Gestión integral de documentos nativos digitales'}</p>
                        </div>
                        <Button onClick={() => setActiveTab('create')}>
                            <Icons.Plus size={20} />
                            <span>Nuevo Documento</span>
                        </Button>
                    </div>

                    <Card className="flex flex-wrap gap-4 items-center !p-4">
                        <div className="flex-1 relative group">
                            <Icons.Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 group-focus-within:text-brand-600 transition-colors" size={20} />
                            <input 
                                type="text" 
                                placeholder="Búsqueda global..." 
                                className="w-full pl-12 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none transition-all bg-slate-50/50 focus:bg-white"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>
                        <div className="flex gap-3">
                            <select className="px-4 py-3 border border-slate-200 rounded-xl bg-slate-50/50 text-slate-700 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none cursor-pointer hover:bg-white transition-colors">
                                <option>Todos los Tipos</option>
                                <option>Resolución</option>
                                <option>Informe Técnico</option>
                            </select>
                            <Button variant="secondary" className="!px-4" onClick={() => { setSearchQuery(''); setColumnFilters({ title: '', type: '', keyword: '', author: '', date: '', institution: '', digitaliaId: '', status: '' }); }}>
                                <Icons.Filter size={20} /> <span className="ml-2 text-sm">Limpiar</span>
                            </Button>
                        </div>
                    </Card>

                    <Card className="!p-0 overflow-hidden">
                        <table className="w-full text-left border-collapse">
                            <thead className="bg-slate-50/80 text-slate-600 text-xs uppercase tracking-wider border-b border-slate-200">
                                {/* Fila de Títulos */}
                                <tr>
                                    <th className="px-6 py-4 text-left font-semibold pb-2">Nombre</th>
                                    <th className="px-6 py-4 text-left font-semibold pb-2">Tipo</th>
                                    <th className="px-6 py-4 text-left font-semibold pb-2">Palabra Clave</th>
                                    <th className="px-6 py-4 text-left font-semibold pb-2">Autor</th>
                                    <th className="px-6 py-4 text-center font-semibold pb-2">Fecha</th>
                                    <th className="px-6 py-4 text-left font-semibold pb-2">Institución</th>
                                    <th className="px-6 py-4 text-center font-semibold pb-2">Expediente</th>
                                    <th className="px-6 py-4 text-center font-semibold pb-2">Estado</th>
                                    <th className="px-6 py-4 text-center font-semibold pb-2">Acciones</th>
                                </tr>
                                {/* Fila de Filtros */}
                                <tr className="bg-slate-50 border-b border-slate-200">
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="Filtrar..." 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                            value={columnFilters.title}
                                            onChange={(e) => setColumnFilters({...columnFilters, title: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="Tipo..." 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                            value={columnFilters.type}
                                            onChange={(e) => setColumnFilters({...columnFilters, type: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="Palabra Clave..." 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                            value={columnFilters.keyword}
                                            onChange={(e) => setColumnFilters({...columnFilters, keyword: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="Autor..." 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                            value={columnFilters.author}
                                            onChange={(e) => setColumnFilters({...columnFilters, author: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="AAAA-MM-DD" 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white text-center"
                                            value={columnFilters.date}
                                            onChange={(e) => setColumnFilters({...columnFilters, date: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="Institución..." 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                            value={columnFilters.institution}
                                            onChange={(e) => setColumnFilters({...columnFilters, institution: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <input 
                                            type="text" 
                                            placeholder="Exp..." 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white text-center"
                                            value={columnFilters.digitaliaId}
                                            onChange={(e) => setColumnFilters({...columnFilters, digitaliaId: e.target.value})}
                                        />
                                    </th>
                                    <th className="px-6 pb-4 pt-0">
                                        <select 
                                            className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white text-center cursor-pointer"
                                            value={columnFilters.status}
                                            onChange={(e) => setColumnFilters({...columnFilters, status: e.target.value})}
                                        >
                                            <option value="">Todos</option>
                                            <option value="Activo">Activo</option>
                                            <option value="Inactivo">Inactivo</option>
                                            <option value="Guardado">Guardado</option>
                                        </select>
                                    </th>
                                    <th className="px-6 pb-4 pt-0"></th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {filteredDocs.map((doc) => (
                                    <tr key={doc.id} className="hover:bg-slate-50/80 transition-colors group">
                                        <td className="px-6 py-4 align-middle font-semibold text-slate-900 font-mono text-sm">
                                            {doc.id}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-sm text-slate-700 font-medium">
                                            {doc.type}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-sm">
                                            {doc.keyword ? (
                                                <span className="bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs font-semibold border border-slate-200">
                                                    {doc.keyword}
                                                </span>
                                            ) : <span className="text-slate-400 italic">-</span>}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-sm text-slate-600">
                                            {doc.author}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-sm text-slate-600 text-center">
                                            {doc.date}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-sm text-slate-600">
                                            {doc.institution || 'Gobierno Nacional'}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-center">
                                            {doc.digitaliaId ? (
                                                <span className="inline-flex items-center justify-center gap-1.5 text-xs font-medium text-brand-700 bg-brand-50 px-2.5 py-1 rounded-lg border border-brand-100">
                                                    <Icons.LinkIcon size={12} /><span>{doc.digitaliaId}</span>
                                                </span>
                                            ) : (
                                                <span className="inline-flex items-center justify-center text-xs text-slate-400 italic gap-1"><Icons.X size={12}/> Sin vincular</span>
                                            )}
                                        </td>
                                        <td className="px-6 py-4 align-middle text-center"><Badge status={doc.status} /></td>
                                        <td className="px-6 py-4 align-middle text-center">
                                            <div className="flex justify-center gap-1">
                                                <button onClick={() => setViewDoc(doc)} className="p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded-lg transition-all" title="Visualizar"><Icons.Eye size={18} /></button>
                                                <button onClick={() => setEditDoc({...doc})} className="p-2 text-slate-400 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-all" title="Editar"><Icons.Edit size={18} /></button>
                                                <button onClick={() => setDeleteDoc(doc)} className="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all" title="Eliminar"><Icons.Trash size={18} /></button>
                                                <button onClick={() => alert("Descargando documento...")} className="p-2 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all" title="Descargar"><Icons.Download size={18} /></button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                                {filteredDocs.length === 0 && (
                                    <tr>
                                        <td colSpan="9" className="px-6 py-12 text-center text-slate-400 italic">
                                            No se encontraron documentos con los filtros aplicados.
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </Card>

                    {/* Modales */}
                    {viewDoc && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-scaleIn">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-start bg-slate-50/50">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-brand-100 p-3 rounded-xl text-brand-600"><Icons.FileText size={28} /></div>
                                        <div>
                                            <h3 className="font-bold text-xl text-slate-900">{viewDoc.title}</h3>
                                            <p className="text-sm text-slate-500 font-mono mt-0.5">{viewDoc.id}</p>
                                        </div>
                                    </div>
                                    <button onClick={() => setViewDoc(null)} className="text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-full transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-8 space-y-8">
                                    <div className="grid grid-cols-2 gap-8">
                                        <div><p className="text-xs text-slate-400 uppercase font-bold tracking-wider mb-2">Tipo Documental</p><p className="text-slate-800 font-medium text-lg">{viewDoc.type}</p></div>
                                        <div><p className="text-xs text-slate-400 uppercase font-bold tracking-wider mb-2">Estado Actual</p><Badge status={viewDoc.status} /></div>
                                        <div><p className="text-xs text-slate-400 uppercase font-bold tracking-wider mb-2">Autor</p><div className="flex items-center gap-2 text-slate-800"><Icons.User size={18} className="text-slate-400"/>{viewDoc.author}</div></div>
                                        <div><p className="text-xs text-slate-400 uppercase font-bold tracking-wider mb-2">Fecha</p><div className="flex items-center gap-2 text-slate-800"><Icons.Calendar size={18} className="text-slate-400"/>{viewDoc.date}</div></div>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-indigo-50 to-purple-50 border border-indigo-100 rounded-xl p-5 relative overflow-hidden">
                                        <div className="absolute top-0 right-0 p-4 opacity-10"><Icons.LinkIcon size={80}/></div>
                                        <h4 className="font-bold text-indigo-900 text-sm mb-3 flex items-center gap-2 relative z-10"><Icons.LinkIcon size={18} /> Integración Digitalia</h4>
                                        {viewDoc.digitaliaId ? (
                                            <div className="flex justify-between items-center relative z-10 bg-white/60 p-3 rounded-lg border border-indigo-100/50 backdrop-blur-sm">
                                                <span className="text-indigo-800 text-sm font-medium">Vinculado al expediente: <strong className="text-indigo-950">{viewDoc.digitaliaId}</strong></span>
                                                <a href="#" className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1 hover:underline">Ver expediente <Icons.ExternalLink size={14} /></a>
                                            </div>
                                        ) : (<p className="text-indigo-400 text-sm italic relative z-10">Sin vinculación activa.</p>)}
                                    </div>

                                    <div>
                                        <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><Icons.History size={18} className="text-slate-400" />Historial de Auditoría</h4>
                                        <div className="border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                            <table className="w-full text-left text-sm">
                                                <thead className="bg-slate-50 text-slate-500 border-b border-slate-200"><tr><th className="px-5 py-3 font-medium">Fecha</th><th className="px-5 py-3 font-medium">Usuario</th><th className="px-5 py-3 font-medium">Acción</th></tr></thead>
                                                <tbody className="divide-y divide-slate-100 bg-white">
                                                    <tr><td className="px-5 py-3 text-slate-600">{viewDoc.date} 09:00</td><td className="px-5 py-3 text-slate-800 font-medium">rantola</td><td className="px-5 py-3 text-slate-600">Creación del Documento</td></tr>
                                                    <tr><td className="px-5 py-3 text-slate-800 font-medium">rantola</td><td className="px-5 py-3 text-slate-600">Firma Digital</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-6 flex justify-end gap-3 border-t border-slate-200">
                                    <Button variant="secondary" onClick={() => alert("Descargando...")}><Icons.Download size={18} /> Descargar</Button>
                                    <Button variant="primary" onClick={() => setViewDoc(null)} className="!bg-slate-800 !text-white hover:!bg-slate-900">Cerrar</Button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {editDoc && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-scaleIn">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                    <h3 className="font-bold text-xl text-slate-800">Editar Documento</h3>
                                    <button onClick={() => setEditDoc(null)} className="text-slate-400 hover:text-slate-600"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-8 space-y-6">
                                    <div><label className="block text-sm font-semibold text-slate-700 mb-2">Título del Documento</label><input type="text" value={editDoc.title} onChange={(e) => setEditDoc({...editDoc, title: e.target.value})} className="w-full border border-slate-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all" /></div>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div><label className="block text-sm font-semibold text-slate-700 mb-2">Tipo</label><select value={editDoc.type} onChange={(e) => setEditDoc({...editDoc, type: e.target.value})} className="w-full border border-slate-300 rounded-xl px-4 py-3 bg-white focus:ring-2 focus:ring-brand-500 outline-none"><option>Resolución</option><option>Informe Técnico</option><option>Dictamen</option></select></div>
                                        <div><label className="block text-sm font-semibold text-slate-700 mb-2">Estado</label><select value={editDoc.status} onChange={(e) => setEditDoc({...editDoc, status: e.target.value})} className="w-full border border-slate-300 rounded-xl px-4 py-3 bg-white focus:ring-2 focus:ring-brand-500 outline-none"><option value="Activo">Activo</option><option value="Inactivo">Inactivo</option></select></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div><label className="block text-sm font-semibold text-slate-700 mb-2">Autor</label><input type="text" value={editDoc.author} onChange={(e) => setEditDoc({...editDoc, author: e.target.value})} className="w-full border border-slate-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-brand-500 outline-none" /></div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-6 flex justify-end gap-3 border-t border-slate-100">
                                    <Button variant="ghost" onClick={() => setEditDoc(null)}>Cancelar</Button>
                                    <Button variant="primary" onClick={handleUpdateDoc}><Icons.Save size={18} /> Guardar Cambios</Button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {deleteDoc && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden p-8 text-center animate-scaleIn">
                                <div className="mx-auto bg-red-100 w-20 h-20 rounded-full flex items-center justify-center text-red-500 mb-6 shadow-lg shadow-red-100"><Icons.AlertTriangle size={40} /></div>
                                <h3 className="font-bold text-xl text-slate-900 mb-2">¿Eliminar Documento?</h3>
                                <p className="text-slate-500 mb-6 text-sm leading-relaxed">Esta acción es irreversible. Se eliminará <strong>"{deleteDoc.title}"</strong> y se desvinculará de Digitalia.</p>
                                <div className="flex flex-col gap-3">
                                    <Button variant="danger" className="w-full justify-center !bg-red-600 !text-white hover:!bg-red-700 shadow-md hover:shadow-lg shadow-red-500/30" onClick={handleDeleteConfirm}>Sí, eliminar documento</Button>
                                    <Button variant="ghost" className="w-full justify-center" onClick={() => setDeleteDoc(null)}>Cancelar</Button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const CreateDocumentView = ({ setActiveTab, documents, setDocuments }) => {
            const [step, setStep] = useState(1);
            const [creationMode, setCreationMode] = useState('word');
            const [downloadingTemplate, setDownloadingTemplate] = useState(null);
            const [selectedTemplate, setSelectedTemplate] = useState(null);
            const [uploading, setUploading] = useState(false);
            const [isSaved, setIsSaved] = useState(false);
            const [showDigitaliaModal, setShowDigitaliaModal] = useState(false);
            const [relatedTramites, setRelatedTramites] = useState([]);
            const [digitaliaSearch, setDigitaliaSearch] = useState('');
            const [selectedDigitaliaExp, setSelectedDigitaliaExp] = useState(null);
            const [digitaliaSearchResults, setDigitaliaSearchResults] = useState([]);
            const [formData, setFormData] = useState({ title: '', date: new Date().toISOString().split('T')[0], responsible: 'Cynthia Gonzalez', visibility: 'Público', designatedUsers: [], content: 'Se procede a la firma...' });
            
            const [generatedId, setGeneratedId] = useState('');
            const [availableUsers] = useState(['Rodrigo Antola', 'Juan Perez', 'Maria Lopez', 'Admin Sistema', 'Carlos Ruiz']);
            const [selectedUserToAdd, setSelectedUserToAdd] = useState('');
            const [isUserDropdownOpen, setIsUserDropdownOpen] = useState(false);
            const [userSearchTerm, setUserSearchTerm] = useState('');

            const handleDownloadTemplate = (e, type) => {
                e.stopPropagation();
                setDownloadingTemplate(type);
                setTimeout(() => {
                    const element = document.createElement("a");
                    const fileContent = `Plantilla Oficial para ${type}\n\nGobierno Nacional\n\n[Espacio reservado para contenido]`;
                    const file = new Blob([fileContent], {type: 'text/plain'});
                    element.href = URL.createObjectURL(file);
                    element.download = `Plantilla_${type}.docx`;
                    document.body.appendChild(element); 
                    element.click();
                    document.body.removeChild(element);
                    setDownloadingTemplate(null);
                }, 1000);
            };

            const handleUpload = () => { setUploading(true); setTimeout(() => { setUploading(false); setStep(3); }, 2000); };
            const handleFormSubmit = () => { setUploading(true); setTimeout(() => { setUploading(false); setStep(3); }, 1500); };
            
            const handleSaveRepository = () => { 
                setIsSaved(true);
                const type = selectedTemplate || 'Documento';
                const prefix = type.substring(0, 3).toUpperCase();
                const year = new Date().getFullYear();
                let maxSeq = 0;
                const patternPrefix = `${prefix}-${year}-`;
                
                documents.forEach(doc => {
                    if (doc.id.startsWith(patternPrefix)) {
                        const parts = doc.id.split('-');
                        if (parts.length === 3) {
                            const seq = parseInt(parts[2], 10);
                            if (!isNaN(seq) && seq > maxSeq) {
                                maxSeq = seq;
                            }
                        }
                    }
                });
                
                const nextSeq = (maxSeq + 1).toString().padStart(4, '0');
                const newId = `${prefix}-${year}-${nextSeq}`;
                
                setGeneratedId(newId);

                setDocuments(prev => [{ 
                    id: newId, 
                    title: creationMode === 'form' ? formData.title : `${selectedTemplate} N° ${year}/${nextSeq}`, 
                    type: selectedTemplate || 'Documento', 
                    keyword: 'General',
                    author: formData.responsible, 
                    date: formData.date, 
                    institution: 'Ministerio de Tecnologías', 
                    status: 'Guardado', 
                    digitaliaId: null, 
                    hash: '7f8...1a' 
                }, ...prev]); 
            };
            
            const handleSearchDigitalia = () => {
                if (digitaliaSearch.length > 0) {
                    setDigitaliaSearchResults([
                        { id: 'EXP-2026-8812', title: 'Solicitud de Insumos - Dpto. IT' },
                        { id: 'EXP-2026-9923', title: 'Auditoría Financiera Q1' },
                        { id: 'EXP-2026-1024', title: 'Reestructuración de Personal' }
                    ].filter(e => e.id.toLowerCase().includes(digitaliaSearch.toLowerCase()) || e.title.toLowerCase().includes(digitaliaSearch.toLowerCase())));
                } else {
                    setDigitaliaSearchResults([]);
                }
            };
            
            const handleAddTramite = () => { 
                if (selectedDigitaliaExp && !relatedTramites.find(t => t.id === selectedDigitaliaExp.id)) { 
                    setRelatedTramites([...relatedTramites, selectedDigitaliaExp]); 
                    setSelectedDigitaliaExp(null); 
                    setDigitaliaSearch(''); 
                    setDigitaliaSearchResults([]);
                } 
            };
            
            const handleSaveRelations = () => { 
                setShowDigitaliaModal(false); 
                if (relatedTramites.length > 0) {
                     setDocuments(prev => {
                        const newDocs = [...prev];
                        const targetIndex = newDocs.findIndex(d => d.id === generatedId);
                        if (targetIndex !== -1) {
                            newDocs[targetIndex].digitaliaId = relatedTramites[0].id; 
                        }
                        return newDocs;
                     });
                }
                setStep(4);
            };

            return (
                <div className="max-w-5xl mx-auto space-y-8 animate-fadeIn relative">
                     <div className="mb-8 flex items-center justify-between">
                         <div>
                            <button onClick={() => setActiveTab('repository')} className="text-sm text-slate-500 hover:text-brand-700 mb-2 flex items-center gap-1 font-medium"><Icons.ArrowLeft size={16}/> Volver al repositorio</button>
                            <h2 className="text-3xl font-bold text-slate-900 tracking-tight">Generador de Documentos</h2>
                         </div>
                         {step < 4 && (
                            <div className="flex items-center gap-4">
                                {[1, 2, 3].map(s => (
                                    <div key={s} className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm border-2 transition-all ${step >= s ? 'bg-brand-600 text-white border-brand-600 shadow-lg shadow-brand-500/30' : 'bg-white text-slate-300 border-slate-200'}`}>{s}</div>
                                ))}
                            </div>
                         )}
                     </div>
                     
                     <div className="min-h-[500px]">
                        {step === 1 && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 animate-fadeIn">
                                <Card className={`hover:border-brand-400 transition-colors cursor-pointer group ${creationMode === 'word' ? 'ring-2 ring-brand-500 border-brand-500 bg-brand-50/20' : ''}`} onClick={() => setCreationMode('word')}>
                                    <div className="bg-blue-50 w-16 h-16 rounded-2xl flex items-center justify-center text-blue-600 mb-6 group-hover:scale-110 transition-transform"><Icons.FileText size={32}/></div>
                                    <h3 className="text-xl font-bold text-slate-900 mb-2">Plantilla Word</h3>
                                    <p className="text-slate-500 text-sm leading-relaxed">Descarga una plantilla oficial, edítala en tu equipo y súbela para validación.</p>
                                </Card>
                                <Card className={`hover:border-brand-400 transition-colors cursor-pointer group ${creationMode === 'form' ? 'ring-2 ring-brand-500 border-brand-500 bg-brand-50/20' : ''}`} onClick={() => setCreationMode('form')}>
                                    <div className="bg-purple-50 w-16 h-16 rounded-2xl flex items-center justify-center text-purple-600 mb-6 group-hover:scale-110 transition-transform"><Icons.Monitor size={32}/></div>
                                    <h3 className="text-xl font-bold text-slate-900 mb-2">Formulario Web</h3>
                                    <p className="text-slate-500 text-sm leading-relaxed">Redacta el documento directamente en la plataforma usando campos predefinidos.</p>
                                </Card>
                                <div className="col-span-2 mt-4">
                                    <h4 className="font-semibold text-slate-800 mb-4">Tipos de Documento Disponibles</h4>
                                    <div className="grid grid-cols-2 gap-4">
                                        {['Resolución Ministerial', 'Informe Técnico', 'Dictamen Jurídico', 'Memorándum'].map(type => (
                                            <div key={type} onClick={() => setSelectedTemplate(type)} className={`border rounded-xl p-4 cursor-pointer flex justify-between items-center transition-all ${selectedTemplate === type ? 'border-brand-500 bg-brand-50/50 shadow-md ring-1 ring-brand-500' : 'bg-white hover:border-brand-300'}`}>
                                                <div className="flex items-center gap-3"><div className={`p-2 rounded-lg ${selectedTemplate === type ? 'bg-brand-100 text-brand-700' : 'bg-slate-100 text-slate-500'}`}><Icons.FileText size={20}/></div><span className={`font-medium ${selectedTemplate === type ? 'text-brand-900' : 'text-slate-700'}`}>{type}</span></div>
                                                {creationMode === 'word' && (
                                                    <button onClick={(e) => handleDownloadTemplate(e, type)} className="p-2 text-slate-400 hover:text-brand-600 hover:bg-white rounded-full transition-colors" title="Descargar Plantilla"><Icons.Download size={20}/></button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex justify-end mt-8"><Button disabled={!selectedTemplate} onClick={() => setStep(2)}>Continuar <Icons.ArrowRight size={18}/></Button></div>
                                </div>
                            </div>
                        )}

                        {step === 2 && (
                             <Card className="animate-fadeIn">
                                <div className="flex justify-between items-center mb-6 border-b border-slate-100 pb-4"><h3 className="text-lg font-bold text-slate-800">2. {creationMode === 'word' ? 'Carga de Archivo' : 'Completar Datos Requeridos'}</h3><span className="text-xs font-semibold bg-slate-100 text-slate-600 px-3 py-1 rounded-full uppercase tracking-wider">{creationMode === 'word' ? 'Modo Offline' : 'Modo Online'}</span></div>
                                
                                <div className="space-y-6">
                                    <div className="grid grid-cols-2 gap-6 items-start">
                                        <div>
                                            <label className="block text-sm font-semibold text-slate-700 mb-2">Visibilidad</label>
                                            <select value={formData.visibility} onChange={e => setFormData({...formData, visibility: e.target.value})} className="w-full border border-slate-300 rounded-xl p-3 bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                                                <option>Público</option>
                                                <option>Privado</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-slate-700 mb-2">Fecha</label>
                                            <input type="date" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} className="w-full border border-slate-300 rounded-xl p-3 focus:ring-2 focus:ring-brand-500 outline-none"/>
                                        </div>
                                    </div>
                                    
                                    {formData.visibility === 'Privado' && (
                                        <div className="bg-slate-50 border border-slate-200 rounded-xl p-5 animate-fadeIn shadow-inner relative">
                                            <label className="block text-sm font-semibold text-slate-700 mb-2 flex items-center gap-2"><Icons.Shield size={16} className="text-slate-500"/> Compartir solo con usuarios específicos</label>
                                            <div className="flex gap-2 mb-3 relative">
                                                
                                                {/* Dropdown Customizado con Buscador */}
                                                <div className="relative flex-1">
                                                    <div
                                                        className={`w-full border ${isUserDropdownOpen ? 'border-brand-500 ring-2 ring-brand-500/20' : 'border-slate-300'} rounded-xl px-4 py-2.5 bg-white cursor-pointer flex justify-between items-center text-sm transition-all h-full`}
                                                        onClick={() => setIsUserDropdownOpen(!isUserDropdownOpen)}
                                                    >
                                                        <span className={selectedUserToAdd ? "text-slate-900 font-medium" : "text-slate-500"}>
                                                            {selectedUserToAdd || "Seleccione un usuario para dar acceso..."}
                                                        </span>
                                                        <Icons.ChevronDown size={16} className={`text-slate-400 transition-transform ${isUserDropdownOpen ? 'rotate-180' : ''}`} />
                                                    </div>

                                                    {isUserDropdownOpen && (
                                                        <>
                                                            <div className="fixed inset-0 z-10" onClick={() => setIsUserDropdownOpen(false)}></div>
                                                            <div className="absolute z-20 w-full mt-2 bg-white border border-slate-200 rounded-xl shadow-xl overflow-hidden animate-scaleIn origin-top">
                                                                <div className="p-3 border-b border-slate-100 bg-slate-50">
                                                                    <div className="relative">
                                                                        <Icons.Search size={14} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" />
                                                                        <input
                                                                            type="text"
                                                                            autoFocus
                                                                            placeholder="Buscar usuario..."
                                                                            value={userSearchTerm}
                                                                            onChange={(e) => setUserSearchTerm(e.target.value)}
                                                                            className="w-full pl-8 pr-3 py-2 text-sm border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all bg-white"
                                                                        />
                                                                    </div>
                                                                </div>
                                                                <div className="max-h-48 overflow-y-auto py-1">
                                                                    {availableUsers
                                                                        .filter(u => !formData.designatedUsers.includes(u))
                                                                        .filter(u => u.toLowerCase().includes(userSearchTerm.toLowerCase()))
                                                                        .length > 0 ? (
                                                                        availableUsers
                                                                            .filter(u => !formData.designatedUsers.includes(u))
                                                                            .filter(u => u.toLowerCase().includes(userSearchTerm.toLowerCase()))
                                                                            .map(u => (
                                                                                <div
                                                                                    key={u}
                                                                                    className="px-4 py-2.5 text-sm text-slate-700 hover:bg-brand-50 hover:text-brand-700 cursor-pointer flex items-center gap-2 transition-colors"
                                                                                    onClick={() => {
                                                                                        setSelectedUserToAdd(u);
                                                                                        setIsUserDropdownOpen(false);
                                                                                        setUserSearchTerm('');
                                                                                    }}
                                                                                >
                                                                                    <Icons.User size={14} className="text-slate-400" /> {u}
                                                                                </div>
                                                                            ))
                                                                    ) : (
                                                                        <div className="px-4 py-4 text-sm text-slate-500 italic text-center">No se encontraron resultados</div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </>
                                                    )}
                                                </div>

                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        if (selectedUserToAdd && !formData.designatedUsers.includes(selectedUserToAdd)) {
                                                            setFormData({...formData, designatedUsers: [...formData.designatedUsers, selectedUserToAdd]});
                                                            setSelectedUserToAdd('');
                                                            setUserSearchTerm('');
                                                        }
                                                    }}
                                                    disabled={!selectedUserToAdd}
                                                    className="bg-brand-100 text-brand-700 px-5 py-2.5 rounded-xl font-medium hover:bg-brand-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm flex items-center gap-1"
                                                >
                                                    <Icons.Plus size={16}/> Agregar
                                                </button>
                                            </div>
                                            
                                            <div className="min-h-[40px] border border-dashed border-slate-300 rounded-lg p-2 bg-white flex flex-wrap gap-2 items-center relative z-0">
                                                {formData.designatedUsers.length > 0 ? (
                                                    formData.designatedUsers.map(u => (
                                                        <span key={u} className="bg-brand-50 border border-brand-200 text-brand-800 px-3 py-1.5 rounded-lg text-xs font-semibold flex items-center gap-2 shadow-sm transition-all">
                                                            <Icons.User size={12} className="opacity-50"/> {u}
                                                            <button
                                                                type="button"
                                                                onClick={() => setFormData({...formData, designatedUsers: formData.designatedUsers.filter(user => user !== u)})}
                                                                className="text-brand-400 hover:text-red-500 hover:bg-red-50 rounded-full p-0.5 transition-colors"
                                                            >
                                                                <Icons.X size={14} />
                                                            </button>
                                                        </span>
                                                    ))
                                                ) : (
                                                    <p className="text-xs text-slate-400 italic px-2 w-full text-center">Si no selecciona usuarios, el documento será estrictamente personal.</p>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {creationMode === 'form' ? (
                                        <>
                                            <div className="grid grid-cols-3 gap-6"><div className="col-span-2"><label className="block text-sm font-semibold text-slate-700 mb-2">Título del Documento</label><input type="text" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} className="w-full border border-slate-300 rounded-xl p-3 focus:ring-2 focus:ring-brand-500 outline-none"/></div><div><label className="block text-sm font-semibold text-slate-700 mb-2">Responsable</label><input type="text" value={formData.responsible} onChange={e => setFormData({...formData, responsible: e.target.value})} className="w-full border border-slate-300 rounded-xl p-3 focus:ring-2 focus:ring-brand-500 outline-none"/></div></div>
                                            <div><label className="block text-sm font-semibold text-slate-700 mb-2">Cuerpo del Documento</label><textarea rows={8} value={formData.content} onChange={e => setFormData({...formData, content: e.target.value})} className="w-full border border-slate-300 rounded-xl p-3 focus:ring-2 focus:ring-brand-500 outline-none"></textarea></div>
                                            <div className="flex justify-end"><Button onClick={handleFormSubmit}>Generar Vista Previa</Button></div>
                                        </>
                                    ) : (
                                        <div className="text-center pt-6 border-t border-slate-100">
                                            <p className="text-slate-600 mb-6">Suba el archivo <strong>{selectedTemplate}.docx</strong> editado.</p>
                                            <div className="border-2 border-dashed border-brand-200 bg-brand-50/30 rounded-2xl p-12 hover:bg-brand-50 transition cursor-pointer group" onClick={handleUpload}>
                                                {uploading ? (
                                                    <div className="animate-pulse">
                                                        <div className="w-16 h-16 bg-brand-200 rounded-full mx-auto mb-4"></div>
                                                        <p className="text-brand-700 font-medium">Procesando documento...</p>
                                                    </div>
                                                ) : (
                                                    <div>
                                                        <div className="mx-auto bg-white w-20 h-20 rounded-full flex items-center justify-center text-brand-600 mb-4 shadow-sm group-hover:scale-110 transition-transform">
                                                            <Icons.Upload size={40}/>
                                                        </div>
                                                        <p className="text-slate-800 font-medium text-lg">Haga clic para subir</p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                {creationMode === 'word' && <div className="flex justify-start mt-6"><Button variant="ghost" onClick={() => setStep(1)}>← Volver</Button></div>}
                             </Card>
                        )}

                        {step === 3 && (
                             <div className="space-y-6 animate-fadeIn">
                                 <div className="flex items-center gap-3 text-emerald-800 bg-emerald-50 p-4 rounded-xl border border-emerald-100 shadow-sm"><div className="bg-emerald-200 rounded-full p-1"><Icons.CheckCircle size={20} className="text-emerald-700"/></div><span className="font-semibold">Documento procesado y sellado exitosamente.</span></div>
                                 <div className="flex gap-6 h-[750px]">
                                     <div className="flex-1 bg-slate-200/50 p-8 rounded-xl border border-slate-300 overflow-y-auto shadow-inner flex justify-center">
                                         {/* Vista Previa Mejorada - Estilo Certificado/Informe */}
                                         <div className="bg-white shadow-2xl p-12 w-full max-w-[650px] min-h-[800px] text-slate-900 relative font-sans flex flex-col">
                                             
                                            <div className="flex justify-between items-center mb-2">
                                                <div className="w-20 flex flex-col items-center justify-center">
                                                    <div className="w-14 h-14 rounded-full border-2 border-slate-800 flex items-center justify-center p-1">
                                                        <div className="w-full h-full rounded-full border border-slate-400 flex items-center justify-center bg-slate-50">
                                                            <Icons.Building size={24} className="text-slate-800"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="text-center flex-1 px-4">
                                                    <h1 className="text-2xl font-bold uppercase tracking-tight text-slate-900 leading-none mb-1">Gobierno Nacional</h1>
                                                    <p className="text-xs font-bold text-slate-600 uppercase tracking-widest">Sistema de Gestión Documental Unificado</p>
                                                </div>
                                                <div className="w-20 flex justify-center">
                                                     <div className="flex items-end space-x-1 opacity-80">
                                                        <div className="w-2 h-6 bg-red-600 rounded-t-sm"></div>
                                                        <div className="w-2 h-8 bg-slate-200 border border-slate-300 rounded-t-sm"></div>
                                                        <div className="w-2 h-5 bg-blue-600 rounded-t-sm"></div>
                                                     </div>
                                                </div>
                                            </div>

                                            <div className="border-b-4 border-slate-900 mb-1"></div>
                                            <div className="border-b border-slate-400 mb-6"></div>

                                            <div className="text-center mb-6">
                                                <h2 className="text-xl font-bold text-slate-900 mb-1">{creationMode === 'form' ? formData.title : `${selectedTemplate || 'INFORME DE GESTIÓN'} - ÁREA ADMINISTRATIVA`}</h2>
                                                <div className="flex justify-end">
                                                    <span className="text-[10px] font-medium text-slate-500">Página 1 de 1</span>
                                                </div>
                                                <div className="border-b border-slate-800 mt-1"></div>
                                            </div>

                                            <div className="text-center mb-8 py-4 bg-slate-50/50">
                                                <h3 className="text-2xl font-bold uppercase text-slate-900 tracking-wide mb-2">{formData.responsible.toUpperCase()}</h3>
                                                <p className="text-sm font-medium text-slate-600">Con Documento de Identidad N°: 3.998.588</p>
                                            </div>

                                            <div className="mb-8 px-6 text-center flex-1">
                                                <p className="text-sm font-semibold uppercase leading-7 tracking-wide text-slate-800">
                                                    {creationMode === 'form' 
                                                        ? formData.content 
                                                        : "NO POSEE PENDIENTES ADMINISTRATIVOS BAJO LA IDENTIDAD SOLICITADA EN EL SISTEMA DE GESTIÓN UNIFICADO. EL PRESENTE DOCUMENTO CERTIFICA LA INEXISTENCIA DE TRÁMITES VENCIDOS A LA FECHA DE EMISIÓN."}
                                                </p>
                                                <p className="text-xs text-slate-500 mt-4 italic">
                                                    * Este documento es válido para trámites internos y externos.
                                                </p>
                                            </div>

                                            <div className="border-t border-slate-400 mb-3"></div>
                                            <div className="text-[10px] text-justify text-slate-600 font-medium uppercase leading-relaxed mb-6 px-2">
                                                VÁLIDO EN TODO EL TERRITORIO NACIONAL - ASUNCIÓN - CONCEPCIÓN - SAN PEDRO - CORDILLERA - GUAIRÁ - CAAGUAZÚ - CAAZAPÁ - ITAPÚA - MISIONES - PARAGUARÍ - ALTO PARANÁ - CENTRAL - ÑEEMBUCÚ - AMAMBAY - CANINDEYÚ - PRESIDENTE HAYES - BOQUERÓN - ALTO PARAGUAY.
                                            </div>

                                            <div className="bg-slate-100 -mx-12 -mb-12 p-8 border-t border-slate-300 mt-auto rounded-b-sm">
                                                <div className="mb-6">
                                                    <p className="text-xs font-bold text-slate-800 uppercase tracking-wide">
                                                        Fecha de Emisión: <span className="font-mono font-medium text-slate-700">{formData.date} 15:28:04</span>
                                                    </p>
                                                </div>

                                                <div className="flex justify-between items-start">
                                                    <div className="flex flex-col gap-2">
                                                        <p className="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Código de Verificación:</p>
                                                        <div className="bg-white p-1 border-2 border-slate-800 w-fit rounded-sm">
                                                            <Icons.QrCode size={48} className="text-slate-900" />
                                                        </div>
                                                        <p className="text-lg font-bold text-slate-900 tracking-widest font-mono">45549046</p>
                                                    </div>

                                                    <div className="text-right pt-2">
                                                        <p className="text-xs font-bold text-slate-800 leading-relaxed">
                                                            Gobierno Nacional a través del<br/>
                                                            <span className="text-brand-900">Sistema de Gestión Documental Unificado</span>
                                                        </p>
                                                        <p className="text-[10px] text-slate-500 mt-1 font-medium">
                                                            Acordada N° 1092/2016 - Ley N° 405/2025
                                                        </p>
                                                    </div>
                                                </div>

                                                <div className="mt-8 pt-4 border-t border-slate-200 text-center">
                                                    <p className="text-[10px] text-slate-500 font-medium">
                                                        Verifique la validez de este documento en
                                                    </p>
                                                    <p className="text-xs font-bold text-slate-700 tracking-wide">
                                                        http://www.gob.py/verificador
                                                    </p>
                                                </div>
                                            </div>
                                         </div>
                                     </div>
                                     <div className="w-80 space-y-4">
                                         <Card className="h-full flex flex-col">
                                             <h4 className="font-bold text-slate-800 mb-4 pb-2 border-b border-slate-100">Acciones Requeridas</h4>
                                             <div className="space-y-3 flex-1">
                                                 <button onClick={handleSaveRepository} disabled={isSaved} className={`w-full py-4 rounded-xl flex flex-col items-center justify-center gap-2 border transition-all ${isSaved ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : 'bg-white hover:bg-brand-50 text-brand-700 border-brand-200 hover:border-brand-300 shadow-sm'}`}>{isSaved ? <Icons.CheckCircle size={24}/> : <Icons.FileCheck size={24}/>}<span className="font-semibold">{isSaved ? 'Guardado en Repositorio' : '1. Guardar en Repositorio'}</span></button>
                                                 <div className={`relative transition-opacity duration-300 ${!isSaved ? 'opacity-50 pointer-events-none' : 'opacity-100'}`}><button onClick={() => setShowDigitaliaModal(true)} className="w-full py-4 rounded-xl flex flex-col items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-200 transition-all transform hover:-translate-y-0.5"><Icons.LinkIcon size={24}/><span className="font-semibold">2. Relacionar a Digitalia</span></button>{!isSaved && <div className="absolute inset-0 z-10 cursor-not-allowed"></div>}</div>
                                                 
                                                 <div className={`relative transition-opacity duration-300 ${!isSaved ? 'opacity-50 pointer-events-none' : 'opacity-100'}`}>
                                                     <button onClick={() => alert("Iniciando descarga del documento firmado...")} className="w-full py-4 rounded-xl flex flex-col items-center justify-center gap-2 bg-white hover:bg-slate-50 text-slate-700 border border-slate-200 hover:border-slate-300 shadow-sm transition-all transform hover:-translate-y-0.5">
                                                         <Icons.Download size={24}/>
                                                         <span className="font-semibold">Descargar</span>
                                                     </button>
                                                 </div>

                                                 <div className={`relative transition-opacity duration-300 ${!isSaved ? 'opacity-50 pointer-events-none' : 'opacity-100'}`}>
                                                     <button 
                                                         onClick={() => { setActiveTab('repository'); setStep(1); setIsSaved(false); setRelatedTramites([]); }} 
                                                         className="w-full py-4 rounded-xl flex flex-col items-center justify-center gap-2 bg-slate-800 hover:bg-slate-900 text-white shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 border border-slate-700"
                                                     >
                                                         <Icons.CheckSquare size={24}/>
                                                         <span className="font-semibold">Finalizar Proceso</span>
                                                     </button>
                                                 </div>

                                             </div>
                                             <div className="mt-auto text-xs text-slate-400 text-center pt-4 border-t border-slate-100"><p>El documento debe ser guardado antes de poder vincularse a un expediente externo.</p></div>
                                         </Card>
                                     </div>
                                 </div>
                             </div>
                        )}

                        {step === 4 && (
                            <div className="space-y-8 animate-fadeIn p-4">
                                <div className="bg-emerald-50 border border-emerald-200 p-8 rounded-2xl flex items-center gap-6 shadow-sm"><div className="bg-emerald-100 p-4 rounded-full text-emerald-600 shadow-inner"><Icons.CheckCircle size={40} /></div><div><h3 className="text-2xl font-bold text-emerald-900 mb-1">¡Proceso Finalizado con Éxito!</h3><p className="text-emerald-700 text-lg">El documento ha sido guardado en el repositorio y vinculado a los expedientes seleccionados.</p></div></div>
                                <div className="grid grid-cols-3 gap-8">
                                    <Card className="col-span-2">
                                        <h4 className="font-bold text-slate-800 text-lg mb-6 pb-2 border-b border-slate-100 flex items-center gap-2"><Icons.FileText className="text-slate-400"/> Detalles del Documento</h4>
                                        <div className="grid grid-cols-2 gap-y-6 gap-x-8">
                                            <div><p className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Título</p><p className="text-lg font-medium text-slate-900">{creationMode === 'form' ? formData.title : `${selectedTemplate} N° 2026/45`}</p></div>
                                            <div><p className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">ID Sistema</p><p className="font-mono text-slate-600 bg-slate-100 w-fit px-2 rounded">{generatedId || 'Calculando...'}</p></div>
                                            <div><p className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Fecha Emisión</p><p className="text-slate-800">{creationMode === 'form' ? formData.date : '02/02/2026'}</p></div>
                                            <div><p className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Responsable</p><div className="flex items-center gap-2"><div className="w-6 h-6 bg-brand-100 rounded-full flex items-center justify-center text-xs font-bold text-brand-600">CG</div><span className="text-slate-800">{creationMode === 'form' ? formData.responsible : 'Cynthia Gonzalez'}</span></div></div>
                                        </div>
                                    </Card>
                                    <Card className="col-span-1 bg-indigo-50/50 border-indigo-100">
                                        <h4 className="font-bold text-indigo-900 text-lg mb-6 pb-2 border-b border-indigo-100 flex items-center gap-2"><Icons.LinkIcon/> Expedientes ({relatedTramites.length})</h4>
                                        <div className="space-y-3">
                                            {relatedTramites.length > 0 ? (
                                                relatedTramites.map((tramite, idx) => (
                                                    <div key={idx} className="bg-white p-4 rounded-xl shadow-sm border border-indigo-50 flex justify-between items-center group hover:shadow-md transition-all">
                                                        <div><p className="font-bold text-indigo-700 text-sm">{tramite.id}</p><p className="text-xs text-slate-500 truncate max-w-[150px]">{tramite.title}</p></div>
                                                        <a href="#" className="text-indigo-400 hover:text-indigo-600"><Icons.ExternalLink size={18}/></a>
                                                    </div>
                                                ))
                                            ) : (
                                                <p className="text-center text-slate-400 italic py-4">No se realizaron vinculaciones.</p>
                                            )}
                                        </div>
                                    </Card>
                                </div>
                                <div className="flex justify-center pt-6"><Button variant="primary" onClick={() => { setActiveTab('repository'); setStep(1); setIsSaved(false); setRelatedTramites([]); }} className="!px-8 !py-3 !text-lg shadow-xl hover:shadow-2xl"><Icons.Home size={20} /> Volver al Repositorio</Button></div>
                            </div>
                        )}
                     </div>

                     {showDigitaliaModal && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-scaleIn flex flex-col max-h-[80vh]">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <h3 className="font-bold text-xl text-slate-800 flex items-center gap-2"><Icons.LinkIcon className="text-indigo-600"/> Relacionar a Trámite</h3>
                                    <button onClick={() => setShowDigitaliaModal(false)} className="text-slate-400 hover:text-slate-600 bg-white p-1 rounded-full hover:bg-slate-200 transition-colors"><Icons.X size={24} /></button>
                                </div>
                                <div className="p-6 space-y-6 flex-1 overflow-y-auto">
                                    <div className="bg-blue-50 p-4 rounded-xl border border-blue-100 text-sm text-blue-800"><p>Busque el expediente de Digitalia al cual desea vincular este nuevo documento.</p></div>
                                    <div>
                                        <label className="block text-sm font-semibold text-slate-700 mb-2">Buscar Expediente</label>
                                        <div className="flex gap-2"><input type="text" value={digitaliaSearch} onChange={e => setDigitaliaSearch(e.target.value)} className="flex-1 border border-slate-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Ej. EXP-2026..." /><button onClick={handleSearchDigitalia} className="bg-indigo-600 text-white px-4 rounded-xl hover:bg-indigo-700 transition-colors"><Icons.Search size={20}/></button></div>
                                    </div>
                                    {digitaliaSearchResults.length > 0 && !selectedDigitaliaExp && (
                                        <div className="border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                            <div className="bg-slate-50 px-4 py-2 text-xs font-bold text-slate-500 uppercase">Resultados</div>
                                            {digitaliaSearchResults.map(exp => (
                                                <div key={exp.id} onClick={() => setSelectedDigitaliaExp(exp)} className="p-3 hover:bg-indigo-50 cursor-pointer border-b last:border-0 transition-colors flex justify-between items-center group"><div><p className="font-bold text-indigo-900 text-sm">{exp.id}</p><p className="text-xs text-slate-600">{exp.title}</p></div><Icons.PlusCircle size={20} className="text-slate-300 group-hover:text-indigo-600"/></div>
                                            ))}
                                        </div>
                                    )}
                                    {selectedDigitaliaExp && (
                                        <div className="bg-indigo-50 border border-indigo-100 rounded-xl p-4 flex justify-between items-center animate-fadeIn">
                                            <div className="flex items-center gap-3"><div className="bg-white p-2 rounded-full text-indigo-600 shadow-sm"><Icons.FolderOpen size={20}/></div><div><p className="font-bold text-indigo-900 text-sm">{selectedDigitaliaExp.id}</p><p className="text-xs text-indigo-700">{selectedDigitaliaExp.title}</p></div></div>
                                            <button onClick={handleAddTramite} className="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-indigo-700 shadow-md">Agregar a Lista</button>
                                        </div>
                                    )}
                                    <div className="border-t border-slate-100 pt-4">
                                        <div className="flex justify-between items-center mb-2"><p className="font-semibold text-slate-700 text-sm">Expedientes a Vincular</p><span className="bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-xs font-bold">{relatedTramites.length}</span></div>
                                        <div className="bg-slate-50 rounded-xl p-2 min-h-[100px] max-h-[150px] overflow-y-auto border border-slate-200 space-y-2">
                                            {relatedTramites.length === 0 ? <p className="text-center text-slate-400 text-xs py-8 italic">No hay expedientes seleccionados.</p> : relatedTramites.map((t, i) => (<div key={i} className="bg-white p-2 rounded border border-slate-200 flex justify-between items-center shadow-sm"><span className="text-xs font-mono font-medium text-slate-700">{t.id}</span><button onClick={() => setRelatedTramites(prev => prev.filter(item => item.id !== t.id))} className="text-slate-400 hover:text-red-500"><Icons.Trash size={14}/></button></div>))}
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-6 flex justify-end gap-3 border-t border-slate-200">
                                    <Button variant="ghost" onClick={() => setShowDigitaliaModal(false)}>Cancelar</Button>
                                    <Button variant="primary" disabled={relatedTramites.length === 0} onClick={handleSaveRelations} className={relatedTramites.length === 0 ? '!bg-slate-300 !shadow-none' : '!bg-indigo-600 hover:!bg-indigo-700 !shadow-lg shadow-indigo-500/30'}>Confirmar Vinculación ({relatedTramites.length})</Button>
                                </div>
                            </div>
                        </div>
                     )}
                </div>
            );
        };

        const IntegrationView = ({ documents }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [selectedExpediente, setSelectedExpediente] = useState(null);
            const [selectedDocs, setSelectedDocs] = useState([]);
            const [docSearchTerm, setDocSearchTerm] = useState('');
            const [showSummary, setShowSummary] = useState(false);

            const handleSearch = () => { if (searchTerm.length > 3) setSearchResults([{ id: 'EXP-2026-8812', title: 'Solicitud de Insumos - Dpto. IT', area: 'Tecnología' }, { id: 'EXP-2026-9923', title: 'Auditoría Financiera Q1', area: 'Finanzas' }, { id: 'EXP-2026-1024', title: 'Reestructuración de Personal', area: 'Recursos Humanos' }]); };
            
            const handleSelectExpediente = (exp) => {
                setSelectedExpediente(exp);
                setSearchResults([]);
                setSearchTerm('');
            };

            const handleClearExpediente = () => {
                setSelectedExpediente(null);
                setSelectedDocs([]);
                setDocSearchTerm('');
            };

            const toggleDocSelection = (id) => { setSelectedDocs(prev => prev.includes(id) ? prev.filter(d => d !== id) : [...prev, id]); };
            
            const filteredDocs = documents.filter(doc => doc.title.toLowerCase().includes(docSearchTerm.toLowerCase()));

            const handleConfirmLink = () => {
                if (selectedDocs.length > 0 && selectedExpediente) {
                    setShowSummary(true);
                }
            };

            const handleFinish = () => {
                setShowSummary(false);
                handleClearExpediente();
            };

            if (showSummary) {
                return (
                    <div className="space-y-6 animate-fadeIn">
                        <div className="bg-green-50 border border-green-200 p-6 rounded-xl flex items-center space-x-4"><div className="bg-green-100 p-3 rounded-full text-green-700"><Icons.CheckCircle size={32} /></div><div><h3 className="text-xl font-bold text-green-900">¡Vinculación Exitosa!</h3><p className="text-green-700">Se han asociado correctamente {selectedDocs.length} documentos al expediente {selectedExpediente.id}.</p></div></div>
                        <div className="bg-white border border-slate-200 rounded-xl shadow-sm p-6">
                            <h4 className="font-bold text-slate-800 mb-4 pb-2 border-b border-slate-100">Resumen de Operación</h4>
                            <div className="grid grid-cols-2 gap-8 mb-6">
                                <div><p className="text-xs text-slate-500 uppercase font-semibold mb-1">Expediente Destino</p><div className="bg-indigo-50 p-3 rounded-lg border border-indigo-100"><p className="font-bold text-indigo-900">{selectedExpediente.id}</p><p className="text-sm text-indigo-800">{selectedExpediente.title}</p></div></div>
                                <div><p className="text-xs text-slate-500 uppercase font-semibold mb-1">Total Documentos</p><p className="text-2xl font-bold text-slate-800">{selectedDocs.length}</p></div>
                            </div>
                            
                            <div>
                                <p className="text-xs text-slate-500 uppercase font-semibold mb-2">Documentos Vinculados</p>
                                <div className="border border-slate-200 rounded-lg overflow-hidden bg-slate-50">
                                    {selectedDocs.map(docId => {
                                        const doc = documents.find(d => d.id === docId);
                                        return (
                                            <div key={docId} className="flex items-center gap-3 p-3 border-b border-slate-200 last:border-0 bg-white">
                                                <div className="p-1.5 bg-blue-50 text-blue-600 rounded"><Icons.FileText size={16} /></div>
                                                <div>
                                                    <p className="text-sm font-medium text-slate-800">{doc ? doc.title : docId}</p>
                                                    <p className="text-xs text-slate-500 font-mono">{docId}</p>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                        <div className="flex justify-end"><button onClick={handleFinish} className="bg-blue-900 text-white px-6 py-2 rounded flex items-center gap-2"><span>Nueva Vinculación</span><Icons.ArrowRight size={18}/></button></div>
                    </div>
                );
            }

            return (
                <div className="space-y-6 animate-fadeIn">
                    <div className="mb-6"><h2 className="text-2xl font-bold text-slate-800">Integración con Digitalia</h2><p className="text-slate-500">Vincular documentos múltiples del repositorio a un expediente existente.</p></div>
                    <div className="grid grid-cols-3 gap-6">
                        <div className="col-span-2 space-y-6">
                            <div className="bg-white rounded-xl p-6 shadow-sm border border-slate-200 min-h-[500px] flex flex-col">
                                <h3 className="font-semibold text-slate-800 mb-4 flex items-center space-x-2"><Icons.LinkIcon className="text-indigo-600" size={20} /><span>Vinculación Masiva</span></h3>
                                {!selectedExpediente ? (
                                    <div className="space-y-4 animate-fadeIn">
                                        <label className="block text-sm font-medium">1. Buscar Expediente Destino</label>
                                        <div className="flex gap-2"><div className="flex flex-1"><span className="inline-flex items-center px-3 rounded-l-md border border-r-0 border-slate-300 bg-slate-50 text-slate-500 text-sm">EXP-</span><input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSearch()} className="flex-1 block w-full rounded-none rounded-r-md border border-slate-300 py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="2026-XXXX" /></div><button onClick={handleSearch} className="bg-indigo-600 text-white px-4 rounded flex items-center gap-2"><Icons.Search size={16} /><span>Buscar</span></button></div>
                                        {searchResults.length > 0 && <div className="mt-4 border border-slate-200 rounded-lg overflow-hidden"><div className="bg-slate-50 px-4 py-2 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase">Resultados Encontrados</div><div className="divide-y divide-slate-100">{searchResults.map(res => (<button key={res.id} onClick={() => handleSelectExpediente(res)} className="w-full text-left px-4 py-3 hover:bg-indigo-50 transition-colors flex justify-between items-center group"><div><p className="font-medium text-indigo-900">{res.id}</p><p className="text-sm text-slate-600">{res.title}</p></div><div className="flex items-center space-x-2"><span className="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded">{res.area}</span><Icons.ArrowRight size={16} className="text-slate-300 group-hover:text-indigo-500" /></div></button>))}</div></div>}
                                    </div>
                                ) : (
                                    <div className="flex-1 flex flex-col animate-fadeIn border-t border-slate-200 pt-6">
                                        <div className="mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4 flex justify-between items-center animate-fadeIn"><div className="flex items-center space-x-3"><div className="bg-indigo-100 p-2 rounded-full text-indigo-700"><Icons.FolderOpen size={24} /></div><div><p className="text-xs text-indigo-600 font-semibold uppercase tracking-wider">Expediente Destino</p><p className="font-bold text-lg text-indigo-900">{selectedExpediente.id}</p><p className="text-sm text-indigo-800">{selectedExpediente.title}</p></div></div><button onClick={handleClearExpediente} className="text-slate-400 hover:text-red-500 p-2 hover:bg-white rounded-full transition-colors" title="Cambiar Expediente"><Icons.X size={20} /></button></div>
                                        <div className="flex justify-between items-center mb-3"><label className="block text-sm font-medium text-slate-700">2. Seleccione Documentos a Vincular</label><span className="text-xs bg-slate-100 px-2 py-1 rounded text-slate-600">{selectedDocs.length} selected</span></div>
                                        <div className="mb-3 relative"><Icons.Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" size={16} /><input type="text" placeholder="Filtrar documentos por nombre o ID..." className="w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-1 focus:ring-indigo-500 focus:outline-none" value={docSearchTerm} onChange={(e) => setDocSearchTerm(e.target.value)} /></div>
                                        <div className="border border-slate-200 rounded-lg flex-1 overflow-y-auto max-h-64"><div className="divide-y divide-slate-100">{filteredDocs.map(doc => { const isSelected = selectedDocs.includes(doc.id); return (<div key={doc.id} onClick={() => toggleDocSelection(doc.id)} className={`px-4 py-3 flex items-center space-x-4 cursor-pointer transition-colors ${isSelected ? 'bg-blue-50' : 'hover:bg-slate-50'}`}><div className={`text-slate-400 ${isSelected ? 'text-blue-600' : ''}`}>{isSelected ? <Icons.CheckSquare size={20} /> : <Icons.Square size={20} />}</div><div className="flex-1"><p className={`font-medium text-sm ${isSelected ? 'text-blue-900' : 'text-slate-700'}`}>{doc.title}</p><div className="flex items-center space-x-2 text-xs text-slate-500 mt-0.5"><span>{doc.id}</span><span>•</span><span>{doc.date}</span></div></div>{isSelected && <span className="text-xs font-bold text-blue-600 bg-white px-2 py-1 rounded border border-blue-200">Vincular</span>}</div>); })}</div></div>
                                        <div className="mt-6 flex justify-end items-center space-x-4 pt-4 border-t border-slate-100"><button onClick={handleClearExpediente} className="text-slate-600 hover:text-slate-800 text-sm font-medium">Cancelar</button><button onClick={handleConfirmLink} disabled={selectedDocs.length === 0} className={`px-6 py-2 rounded-lg text-white font-medium flex items-center space-x-2 transition-colors ${selectedDocs.length === 0 ? 'bg-slate-300 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700 shadow-md'}`}><Icons.LinkIcon size={18} /><span>Confirmar Vinculación ({selectedDocs.length})</span></button></div>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="col-span-1"><div className="bg-white p-6 rounded-xl border border-slate-200"><h3 className="font-semibold mb-4 flex items-center gap-2"><Icons.ShieldCheck className="text-green-600" size={20}/>Estado del Servicio</h3><div className="text-sm space-y-2"><div className="flex justify-between"><span>API Digitalia:</span><span className="text-green-600">Conectado</span></div><div className="flex justify-between"><span>Servicio de Sellado:</span><span className="text-green-600">Operativo</span></div></div></div><div className="bg-blue-50 border border-blue-100 rounded-xl p-6 mt-6"><h4 className="text-blue-900 font-semibold mb-2 text-sm">Información</h4><p className="text-xs text-blue-800 leading-relaxed">Esta herramienta permite la <strong>vinculación inversa</strong>.<br/><br/>En lugar de ir documento por documento, seleccione un expediente destino y asigne múltiples archivos del repositorio en una sola acción.</p></div></div>
                    </div>
                </div>
            );
        };

        const ValidateDocumentView = () => {
            const [code, setCode] = useState('');
            const [constancia, setConstancia] = useState('');
            const [validationResult, setValidationResult] = useState(null);
            const [loading, setLoading] = useState(false);

            const generatePDF = () => {
                if (window.jspdf && window.jspdf.jsPDF) {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    const pageWidth = doc.internal.pageSize.getWidth();
                    
                    doc.setFont("helvetica", "bold");
                    doc.setFontSize(14);
                    doc.setTextColor(255, 204, 0);
                    doc.text("★", 15, 22);
                    doc.setTextColor(0, 0, 0);
                    doc.text("GOBIERNO DEL\nPARAGUAY", 25, 20);
                    
                    doc.setTextColor(30, 58, 138);
                    doc.setFontSize(14);
                    doc.text("Ministerio de Salud Pública y\nBienestar Social", 105, 20, { align: "center" });
                    
                    doc.setFontSize(9);
                    const topUrl = "https://www.mspbs.gov.py";
                    doc.text(topUrl, 105, 30, { align: "center" });
                    const topUrlWidth = doc.getTextWidth(topUrl);
                    doc.link(105 - (topUrlWidth / 2), 27, topUrlWidth, 4, { url: topUrl });
                    
                    doc.setTextColor(0, 0, 0);
                    
                    doc.setFontSize(9);
                    doc.text("Constancia Nro.", 195, 15, { align: "right" });
                    doc.setFont("helvetica", "bold");
                    doc.text(constancia, 195, 19, { align: "right" });
                    
                    doc.setFillColor(0, 0, 0);
                    let bx = 160;
                    for(let i=0; i<22; i++){
                        let w = Math.random() > 0.5 ? 0.6 : 1.5;
                        doc.rect(bx, 21, w, 8, 'F');
                        bx += w + 0.6;
                    }
                    
                    doc.setFont("helvetica", "bold");
                    doc.text(constancia, 195, 33, { align: "right" });

                    doc.setLineWidth(0.3);
                    doc.line(15, 38, 195, 38);

                    doc.setFontSize(16);
                    doc.text("Certificado Electrónico Internacional de Vacunación", 105, 48, { align: "center" });

                    doc.line(15, 52, 195, 52);

                    doc.setFontSize(10);
                    doc.setFont("helvetica", "bold");
                    doc.text("Nombre y Apellido:", 15, 62);
                    doc.text("Cédula:", 15, 68);
                    doc.text("Fecha de Nacimiento:", 15, 74);
                    doc.text("Nacionalidad:", 15, 80);

                    doc.setFont("helvetica", "normal");
                    doc.text("FERNANDO MANUEL MANCIA ZELAYA", 65, 62);
                    doc.text("3298639", 65, 68);
                    doc.text("23/10/1984", 65, 74);
                    doc.text("PARAGUAYA", 65, 80);

                    if (doc.autoTable) {
                        doc.autoTable({
                            startY: 85,
                            theme: 'grid',
                            headStyles: { fillColor: [255, 255, 255], textColor: 0, fontStyle: 'bold', lineColor: 0, lineWidth: 0.2, halign: 'center' },
                            bodyStyles: { lineColor: 0, lineWidth: 0.2, halign: 'center', textColor: 0 },
                            head: [['Código de Lote', 'Código Vacuna', 'Dosis', 'Establecimiento de Salud', 'Fecha de\nVacunación']],
                            body: [['18PDFA105', 'Fiebre Amarilla', 'Dosis Unica', 'H.M.I SAN LORENZO', '13/01/2020']]
                        });

                        doc.setFont("helvetica", "normal");
                        doc.setFontSize(9);
                        const text1 = "Este certificado solo será válido si la vacuna fue aprobada por la Organización Mundial de la Salud y el centro de vacunación acreditado por la administración sanitaria del territorio donde se utilice. Debido a que 1 dosis de la vacuna contra la Fiebre Amarilla (FA) genera inmunidad de por vida, la validez de este certificado es de por vida comenzando 10 días después de la inoculación de la vacuna. Cualquier alteración, borroneado u omisión en este certificado afectará su validez.";
                        doc.text(text1, 15, doc.lastAutoTable.finalY + 8, { maxWidth: 180, align: "justify" });

                        let currentY = doc.lastAutoTable.finalY + 30;
                        doc.setFont("helvetica", "bold");
                        doc.setFontSize(11);
                        doc.text("Otras vacunas (última dosis): Poliomielitis, Sarampión/Rubeola", 15, currentY);

                        doc.autoTable({
                            startY: currentY + 3,
                            theme: 'grid',
                            headStyles: { fillColor: [255, 255, 255], textColor: 0, fontStyle: 'bold', lineColor: 0, lineWidth: 0.2, halign: 'center' },
                            bodyStyles: { lineColor: 0, lineWidth: 0.2, halign: 'center', textColor: 0 },
                            head: [['Código de Lote', 'Código Vacuna', 'Dosis', 'Establecimiento de Salud', 'Fecha de\nVacunación']],
                            body: [['0098N012', 'Sarampion', '1ª Dosis', 'H.M.I SAN LORENZO', '13/01/2020']]
                        });

                        currentY = doc.lastAutoTable.finalY + 8;
                        doc.setFont("helvetica", "normal");
                        doc.setFontSize(9);
                        doc.text("Aprobado según Resolución MSPBS N° 652/2023", 15, currentY);
                        currentY += 8;
                        
                        const text2 = "Articulo 2. Establecer que los documentos \"Certificado Electrónico Internacional de Vacunación\" y \"Certificado Electrónico de Vacunación\" emitido por el portal de gobierno tienen validez en todo el territorio nacional, ante organismos nacionales e internacionales, sean entes públicos y/o privados, ante La cual se deba comprobar el estado de vacunación del titular de esta.\n\nLos datos aquí expuestos provienen del Registro Nominal de Vacunación Electrónico del MSPyBS, a través del Sistema de Intercambio de Información del Estado (SII), por lo que su contenido e integridad es exclusiva responsabilidad de este.\n\nConforme a lo dispuesto en los Artículos 13 y 14 del Decreto N° 8709/2018, toda información y documentos obtenidos mediante el Servicio del Portal Único de Gobierno, proveniente del Sistema de intercambio de información, poseen plena validez para la gestión de servicios o tramites en la administración pública.";
                        doc.text(text2, 15, currentY, { maxWidth: 180, align: "justify" });

                        currentY += 48;
                        doc.line(15, currentY, 195, currentY);
                        currentY += 5;
                        doc.text(`Fecha de emisión: 08/11/2023 15:28:36`, 15, currentY);
                        currentY += 3;
                        doc.line(15, currentY, 195, currentY);

                        currentY += 8;
                        
                        const validationUrl = `https://www.paraguay.gov.py/validar?constancia_nro=${constancia}&codigo_seguridad=${code}`;

                        if (window.QRious) {
                            const qr = new QRious({
                                value: validationUrl,
                                size: 100,
                                level: 'M'
                            });
                            doc.addImage(qr.toDataURL('image/jpeg'), 'JPEG', 15, currentY, 28, 28);
                        } else {
                            doc.setFillColor(50, 50, 50);
                            doc.rect(15, currentY, 28, 28, 'F');
                            doc.setFillColor(0, 0, 0);
                        }

                        doc.setTextColor(255, 204, 0); 
                        doc.text("★", 60, currentY+12);
                        doc.setTextColor(0, 0, 0);
                        doc.setFont("helvetica", "bold");
                        doc.setFontSize(14);
                        doc.text("GOBIERNO DEL\nPARAGUAY", 68, currentY+10);
                        
                        doc.setFont("helvetica", "bold");
                        doc.setFontSize(10);
                        doc.text("Ministerio de Salud Pública y Bienestar Social a\ntravés del Sistema de Intercambio de Información", 120, currentY+10);
                        
                        currentY += 38;
                        doc.setFont("helvetica", "normal");
                        doc.setFontSize(9);
                        doc.text(`Código de verificación: ${code}`, 15, currentY);
                        doc.text("Verifique la validez de este documento", 15, currentY+5);
                        
                        doc.setTextColor(30, 58, 138);
                        doc.text(validationUrl, 15, currentY+10);
                        const bottomUrlWidth = doc.getTextWidth(validationUrl);
                        doc.link(15, currentY+7, bottomUrlWidth, 4, { url: validationUrl });
                        
                    } else {
                        doc.text("Certificado Electrónico validado correctamente.", 20, 30);
                        doc.text(`Constancia: ${constancia}`, 20, 40);
                    }

                    doc.save(`Certificado_Vacunacion_${constancia}.pdf`);
                } else {
                    alert("Las librerías para PDF no se cargaron correctamente. Recarga la página.");
                }
            };

            const handleValidate = (e) => {
                e.preventDefault();
                if (!code || !constancia) return;
                setLoading(true);
                
                setTimeout(() => {
                    setLoading(false);
                    const mockResult = { 
                        valid: true, 
                        docId: 'RES-2026-0001', 
                        title: 'Certificado Electrónico Internacional de Vacunación', 
                        date: '2026-02-02', 
                        author: 'FERNANDO MANUEL MANCIA ZELAYA', 
                        hash: '8a7b9c1d2e3f4g5h6i7j8k9l0m...', 
                        status: 'Activo' 
                    };
                    setValidationResult(mockResult);
                    generatePDF();
                }, 1500);
            };

            return (
                <div className="max-w-2xl mx-auto space-y-8 animate-fadeIn py-10">
                    <div className="text-center space-y-3">
                        <div className="mx-auto bg-brand-100 w-16 h-16 rounded-2xl flex items-center justify-center text-brand-600 mb-4 shadow-glow"><Icons.ShieldCheck size={36} /></div>
                        <h2 className="text-3xl font-bold text-slate-900 tracking-tight">Validación Pública</h2>
                        <p className="text-slate-500 max-w-md mx-auto">Verifique la autenticidad e integridad de los documentos.</p>
                    </div>

                    <Card className="p-8">
                        <form onSubmit={handleValidate} className="space-y-6">
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-2">Nro de constancia</label>
                                <input 
                                    type="text" 
                                    value={constancia} 
                                    onChange={(e) => setConstancia(e.target.value)} 
                                    placeholder="Ej: 4943710" 
                                    className="w-full border border-slate-300 rounded-xl px-5 py-3 text-lg font-mono tracking-wide focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all" 
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-700 mb-2">Código de Verificación</label>
                                <div className="flex gap-3">
                                    <input type="text" value={code} onChange={(e) => setCode(e.target.value)} placeholder="Ej: bbf911df" className="flex-1 border border-slate-300 rounded-xl px-5 py-3 text-lg font-mono tracking-wide focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all" />
                                    <button type="button" className="px-4 py-3 border border-slate-300 rounded-xl hover:bg-slate-50 text-slate-600 transition-colors" title="Escanear QR"><Icons.QrCode size={24} /></button>
                                </div>
                            </div>
                            <Button variant="primary" className="w-full py-4 text-lg !shadow-xl hover:!shadow-2xl" disabled={loading || !code || !constancia}>
                                {loading ? <span className="animate-pulse">Validando y Generando PDF...</span> : <><Icons.ShieldCheck size={24} /> Validar Integridad</>}
                            </Button>
                        </form>
                    </Card>

                    {validationResult && (
                         <div className="bg-white rounded-2xl shadow-xl border-l-4 border-emerald-500 overflow-hidden animate-scaleIn">
                             <div className="p-6 bg-emerald-50/50 flex items-start justify-between gap-4 border-b border-emerald-100">
                                <div className="flex gap-4 items-start">
                                    <div className="bg-emerald-100 text-emerald-600 p-2 rounded-full"><Icons.CheckCircle size={24} /></div>
                                    <div><h3 className="font-bold text-emerald-900 text-lg">Documento Auténtico</h3><p className="text-emerald-700 text-sm">La firma digital y el sello de integridad son válidos.</p></div>
                                </div>
                             </div>
                             <div className="p-8 grid grid-cols-2 gap-y-6 gap-x-8 text-sm">
                                <div className="col-span-2">
                                    <p className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-1">Documento</p>
                                    <p className="text-lg font-semibold text-slate-900">{validationResult.title}</p>
                                </div>
                                <div><p className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-1">ID / Cédula</p><p className="font-mono text-slate-700">3298639</p></div>
                                <div><p className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-1">Estado</p><Badge status={validationResult.status} /></div>
                                <div className="col-span-2 pt-4 border-t border-slate-100">
                                    <p className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-2">Huella Digital (Hash)</p>
                                    <div className="bg-slate-100 text-slate-600 p-3 rounded-lg font-mono text-xs break-all">{validationResult.hash}</div>
                                </div>
                             </div>
                          </div>
                    )}
                </div>
            );
        };

        const AdminTypesView = () => {
            const [allSystemFields] = useState([ { id: 1, label: 'Asunto Principal' }, { id: 3, label: 'Fecha de Vigencia' }, { id: 5, label: 'Observaciones' }, { id: 9, label: 'Título del Documento' }, { id: 10, label: 'Fecha del Documento' }, { id: 11, label: 'Tipo de Visibilidad' }, { id: 6, label: 'Número de Expediente Relacionado' }, { id: 7, label: 'Departamento Solicitante' } ]);
            
            const [docTypes, setDocTypes] = useState([
                { id: 1, name: 'Resolución Ministerial', code: 'RES', status: 'Activo', format: 'RES-12021001-0001', hasTemplate: true, fields: [allSystemFields[0], allSystemFields[3]] },
                { id: 2, name: 'Informe Técnico', code: 'INF', status: 'Activo', format: 'INF-12021001-0001', hasTemplate: true, fields: [allSystemFields[5], allSystemFields[6]] }
            ]);
            
            const [isCreating, setIsCreating] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [columnFilters, setColumnFilters] = useState({ name: '', code: '', status: '' });
            const [availableFields, setAvailableFields] = useState([]);
            const [assignedFields, setAssignedFields] = useState([]);
            const [newType, setNewType] = useState({ name: '', code: '', template: null });
            
            const [viewType, setViewType] = useState(null);
            const [editType, setEditType] = useState(null);
            const [deleteType, setDeleteType] = useState(null);

            const moveField = (field, direction) => {
                if (direction === 'toRight') {
                    setAvailableFields(prev => prev.filter(f => f.id !== field.id));
                    setAssignedFields(prev => [...prev, field]);
                } else {
                    setAssignedFields(prev => prev.filter(f => f.id !== field.id));
                    setAvailableFields(prev => [...prev, field]);
                }
            };

            const resetFields = () => { setAvailableFields([...allSystemFields]); setAssignedFields([]); };
            
            const handleSave = () => { 
                if (newType.name && newType.code) { 
                    setDocTypes([...docTypes, { id: docTypes.length + 1, ...newType, status: 'Activo', format: `${newType.code}-12021001-0001`, hasTemplate: !!newType.template, fields: assignedFields }]); 
                    setIsCreating(false); setNewType({ name: '', code: '', template: null }); resetFields(); 
                } 
            };

            const handleEditClick = (type) => {
                setEditType({ ...type });
                const assigned = type.fields || [];
                setAssignedFields(assigned);
                const assignedIds = assigned.map(f => f.id);
                setAvailableFields(allSystemFields.filter(f => !assignedIds.includes(f.id)));
            };

            const handleUpdate = () => {
                if (editType && editType.name && editType.code) {
                    setDocTypes(docTypes.map(t => t.id === editType.id ? { 
                        ...editType, 
                        format: `${editType.code}-12021001-0001`,
                        hasTemplate: !!editType.template || t.hasTemplate,
                        fields: assignedFields
                    } : t));
                    setEditType(null);
                    setAssignedFields([]);
                    setAvailableFields([]);
                }
            };

            const handleDeleteConfirm = () => {
                if (deleteType) {
                    setDocTypes(docTypes.filter(t => t.id !== deleteType.id));
                    setDeleteType(null);
                }
            };

            const auditHistory = [
                { date: '2025-10-15 09:30', user: 'admin@gob.py', action: 'Creación del Tipo' },
                { date: '2026-01-20 14:15', user: 'cgonzalez', action: 'Modificación de Formato' },
                { date: '2026-02-02 10:05', user: 'sysadmin', action: 'Actualización de Plantilla' },
            ];

            const filteredDocTypes = docTypes.filter(t => {
                const matchesGlobal = t.name.toLowerCase().includes(searchQuery.toLowerCase()) || t.code.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesName = t.name.toLowerCase().includes(columnFilters.name.toLowerCase());
                const matchesCode = t.code.toLowerCase().includes(columnFilters.code.toLowerCase());
                const matchesStatus = columnFilters.status === '' || t.status === columnFilters.status;
                
                return matchesGlobal && matchesName && matchesCode && matchesStatus;
            });

            return (
                <div className="space-y-6 animate-fadeIn relative">
                    <div className="flex justify-between items-center">
                        <div><h2 className="text-2xl font-bold text-slate-800">Administración de Tipos</h2><p className="text-slate-500">Gestión de metadatos y definiciones.</p></div>
                        {!isCreating && <Button onClick={() => { setIsCreating(true); resetFields(); }}><Icons.PlusCircle size={20} /> Crear Tipo</Button>}
                    </div>

                    {isCreating ? (
                        <Card className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-8 border-b border-slate-100 pb-4"><h3 className="text-xl font-bold text-slate-800">Nuevo Tipo Documental</h3><button onClick={() => setIsCreating(false)} className="text-slate-400 hover:text-slate-600"><Icons.X size={24} /></button></div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                                <div className="space-y-6">
                                    <div><label className="block text-sm font-semibold text-slate-700 mb-2">Nombre del Tipo</label><input type="text" value={newType.name} onChange={(e) => { const name = e.target.value; setNewType({ ...newType, name: name, code: name.slice(0, 3).toUpperCase() }) }} className="w-full border border-slate-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-brand-500 outline-none" placeholder="Ej. Resolución" /></div>
                                    <div><label className="block text-sm font-semibold text-slate-700 mb-2">Código</label><input type="text" value={newType.code} onChange={(e) => setNewType({...newType, code: e.target.value.toUpperCase()})} className="w-full border border-slate-300 rounded-xl px-4 py-3 bg-slate-50 font-mono" /><p className="text-xs text-slate-400 mt-2 font-mono">Formato: {newType.code ? `${newType.code}-12021001-0001` : 'CODIGO-...'}</p></div>
                                    <div className="border-2 border-dashed border-slate-300 rounded-2xl p-8 text-center hover:bg-slate-50 transition cursor-pointer" onClick={() => document.getElementById('template-upload').click()}><input id="template-upload" type="file" className="hidden" accept=".docx" onChange={(e) => { if (e.target.files?.[0]) setNewType({...newType, template: e.target.files[0].name}); }} /><div className="bg-brand-50 w-12 h-12 rounded-full flex items-center justify-center text-brand-600 mx-auto mb-3"><Icons.Upload size={24}/></div><p className="font-medium text-slate-700">{newType.template || "Subir Plantilla Base (.docx)"}</p></div>
                                </div>
                                <div className="space-y-3">
                                    <label className="block text-sm font-semibold text-slate-700">Asignación de Campos</label>
                                    <div className="flex gap-4 h-80">
                                        <div className="flex-1 border border-slate-200 rounded-xl overflow-hidden flex flex-col bg-slate-50"><div className="bg-slate-100 p-2 text-xs font-bold text-slate-500 text-center uppercase tracking-wider">Disponibles</div><div className="p-2 space-y-1 overflow-y-auto">{availableFields.map(field => (<div key={field.id} onClick={() => moveField(field, 'toRight')} className="p-2 bg-white border border-slate-200 rounded-lg text-sm cursor-pointer hover:border-brand-300 hover:text-brand-600 hover:shadow-sm transition-all flex justify-between items-center group"><span>{field.label}</span><Icons.ArrowRight size={14} className="text-slate-300 group-hover:text-brand-500"/></div>))}</div></div>
                                        <div className="flex-1 border border-brand-200 rounded-xl overflow-hidden flex flex-col bg-brand-50/30"><div className="bg-brand-100 p-2 text-xs font-bold text-brand-700 text-center uppercase tracking-wider">Asignados</div><div className="p-2 space-y-1 overflow-y-auto">{assignedFields.map(field => (<div key={field.id} onClick={() => moveField(field, 'toLeft')} className="p-2 bg-white border border-brand-200 rounded-lg text-sm font-medium text-brand-800 cursor-pointer hover:bg-red-50 hover:border-red-200 hover:text-red-600 transition-all flex justify-between items-center group"><Icons.ArrowLeft size={14} className="text-brand-300 group-hover:text-red-400"/><span>{field.label}</span></div>))}</div></div>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-8 pt-6 border-t border-slate-100 flex justify-end gap-3"><Button variant="ghost" onClick={() => setIsCreating(false)}>Cancelar</Button><Button variant="primary" onClick={handleSave} disabled={!newType.name}><Icons.Save size={18}/> Guardar Tipo</Button></div>
                        </Card>
                    ) : (
                        <div className="space-y-6">
                            <Card className="flex flex-wrap gap-4 items-center !p-4">
                                <div className="flex-1 relative group">
                                    <Icons.Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 group-focus-within:text-brand-600 transition-colors" size={20} />
                                    <input 
                                        type="text" 
                                        placeholder="Buscar tipo documental por nombre o código..." 
                                        className="w-full pl-12 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none transition-all bg-slate-50/50 focus:bg-white"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                </div>
                                <Button variant="secondary" className="!px-4" onClick={() => { setSearchQuery(''); setColumnFilters({ name: '', code: '', status: '' }); }}>
                                    <Icons.Filter size={20} /> <span className="ml-2 text-sm">Limpiar</span>
                                </Button>
                            </Card>
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                 <table className="w-full text-left">
                                    <thead className="bg-slate-50 text-slate-600 text-xs uppercase tracking-wider border-b border-slate-200">
                                        <tr>
                                            <th className="px-6 py-4 pb-2">Nombre</th>
                                            <th className="px-6 py-4 pb-2">Código</th>
                                            <th className="px-6 py-4 pb-2">Estado</th>
                                            <th className="px-6 py-4 pb-2 text-right">Acciones</th>
                                        </tr>
                                        <tr className="bg-slate-50 border-b border-slate-200">
                                            <th className="px-6 pb-4 pt-0">
                                                <input 
                                                    type="text" 
                                                    placeholder="Filtrar..." 
                                                    className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                                    value={columnFilters.name}
                                                    onChange={(e) => setColumnFilters({...columnFilters, name: e.target.value})}
                                                />
                                            </th>
                                            <th className="px-6 pb-4 pt-0">
                                                <input 
                                                    type="text" 
                                                    placeholder="Filtrar..." 
                                                    className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white"
                                                    value={columnFilters.code}
                                                    onChange={(e) => setColumnFilters({...columnFilters, code: e.target.value})}
                                                />
                                            </th>
                                            <th className="px-6 pb-4 pt-0">
                                                <select 
                                                    className="w-full px-3 py-2 text-sm font-normal border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none bg-white cursor-pointer"
                                                    value={columnFilters.status}
                                                    onChange={(e) => setColumnFilters({...columnFilters, status: e.target.value})}
                                                >
                                                    <option value="">Todos</option>
                                                    <option value="Activo">Activo</option>
                                                    <option value="Inactivo">Inactivo</option>
                                                </select>
                                            </th>
                                            <th className="px-6 pb-4 pt-0"></th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {filteredDocTypes.map(t => (
                                         <tr key={t.id} className="hover:bg-slate-50 transition-colors">
                                             <td className="px-6 py-4 font-medium text-slate-800">{t.name}</td>
                                             <td className="px-6 py-4 font-mono text-sm text-slate-600">{t.code}</td>
                                             <td className="px-6 py-4"><Badge status={t.status} /></td>
                                             <td className="px-6 py-4 text-right"><div className="flex justify-end gap-1"><button onClick={() => setViewType(t)} className="p-2 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded-lg"><Icons.Eye size={18} /></button><button onClick={() => handleEditClick(t)} className="p-2 text-slate-400 hover:text-amber-600 hover:bg-amber-50 rounded-lg"><Icons.Edit size={18} /></button><button onClick={() => setDeleteType(t)} className="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg"><Icons.Trash size={18} /></button></div></td>
                                         </tr>
                                        ))}
                                        {filteredDocTypes.length === 0 && (
                                            <tr>
                                                <td colSpan="4" className="px-6 py-12 text-center text-slate-400 italic">No se encontraron resultados para la búsqueda.</td>
                                            </tr>
                                        )}
                                    </tbody>
                                 </table>
                            </div>
                        </div>
                    )}
                    
                    {viewType && <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn"><Card className="w-[600px] animate-scaleIn">
                        <div className="flex justify-between items-center border-b border-slate-100 pb-4 mb-6"><h3 className="font-bold text-xl text-slate-800">{viewType.name}</h3><button onClick={() => setViewType(null)} className="text-slate-400 hover:text-slate-600"><Icons.X size={24}/></button></div>
                        <div className="grid grid-cols-2 gap-6 mb-6">
                            <div><p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Código</p><p className="font-mono text-slate-700 bg-slate-50 p-2 rounded">{viewType.code}</p></div>
                            <div><p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Formato</p><p className="font-mono text-slate-700 bg-slate-50 p-2 rounded">{viewType.format}</p></div>
                            <div><p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Estado</p><Badge status={viewType.status} /></div>
                            <div><p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Plantilla</p><div className="flex items-center gap-2 text-sm text-slate-700">{viewType.hasTemplate ? <><Icons.Paperclip size={16} className="text-brand-500"/> Asignada</> : <span className="text-slate-400 italic">No asignada</span>}</div></div>
                        </div>
                        <div className="mb-6">
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Campos Asociados</p>
                            <div className="flex flex-wrap gap-2">
                                {viewType.fields && viewType.fields.length > 0 ? viewType.fields.map(f => (<span key={f.id} className="text-xs bg-brand-50 text-brand-700 px-2.5 py-1 rounded-full border border-brand-100">{f.label}</span>)) : <span className="text-sm text-slate-400 italic">Sin campos específicos</span>}
                            </div>
                        </div>
                        
                        <div>
                            <h4 className="font-bold text-slate-400 uppercase text-xs tracking-wider mb-3 flex items-center gap-2"><Icons.History size={14}/> Historial de Auditoría</h4>
                            <div className="border border-slate-200 rounded-lg overflow-hidden">
                                <table className="w-full text-left text-xs">
                                    <thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200">
                                            <tr>
                                                <th className="px-4 py-2">Fecha</th>
                                                <th className="px-4 py-2">Usuario</th>
                                                <th className="px-4 py-2">Acción</th>
                                            </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {auditHistory.map((audit, i) => (
                                            <tr key={i} className="hover:bg-slate-50">
                                                <td className="px-4 py-2 text-slate-600">{audit.date}</td>
                                                <td className="px-4 py-2 text-slate-800 font-medium">{audit.user}</td>
                                                <td className="px-4 py-2 text-slate-600">{audit.action}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="mt-6 flex justify-end"><Button variant="secondary" onClick={() => setViewType(null)}>Cerrar</Button></div>
                    </Card></div>}

                    {editType && <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn"><Card className="w-[800px] animate-scaleIn max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center border-b border-slate-100 pb-4 mb-6"><h3 className="font-bold text-xl text-slate-800">Editar Tipo Documental</h3><button onClick={() => setEditType(null)} className="text-slate-400 hover:text-slate-600"><Icons.X size={24}/></button></div>
                        <div className="grid grid-cols-2 gap-8">
                            <div className="space-y-4">
                                <div><label className="block text-sm font-semibold text-slate-700 mb-2">Nombre</label><input type="text" value={editType.name} onChange={(e) => setEditType({...editType, name: e.target.value})} className="w-full border border-slate-300 rounded-xl px-4 py-3" /></div>
                                <div><label className="block text-sm font-semibold text-slate-700 mb-2">Código</label><input type="text" value={editType.code} onChange={(e) => setEditType({...editType, code: e.target.value.toUpperCase()})} className="w-full border border-slate-300 rounded-xl px-4 py-3 bg-slate-50 font-mono" /></div>
                                <div><label className="block text-sm font-semibold text-slate-700 mb-2">Estado</label><select value={editType.status} onChange={(e) => setEditType({...editType, status: e.target.value})} className="w-full border border-slate-300 rounded-xl px-4 py-3 bg-white"><option value="Activo">Activo</option><option value="Inactivo">Inactivo</option></select></div>
                                <div className="border-2 border-dashed border-slate-300 rounded-2xl p-4 text-center hover:bg-slate-50 cursor-pointer flex items-center justify-center gap-3"><div className="bg-brand-50 p-2 rounded-full text-brand-600"><Icons.Upload size={20}/></div><span className="text-sm font-medium text-slate-600">Actualizar Plantilla</span></div>
                            </div>
                            <div className="space-y-3">
                                <label className="block text-sm font-semibold text-slate-700">Editar Asignación de Campos</label>
                                <div className="flex gap-4 h-64">
                                    <div className="flex-1 border border-slate-200 rounded-xl overflow-hidden flex flex-col bg-slate-50"><div className="bg-slate-100 p-2 text-xs font-bold text-slate-500 text-center uppercase">Disponibles</div><div className="p-2 space-y-1 overflow-y-auto">{availableFields.map(field => (<div key={field.id} onClick={() => moveField(field, 'toRight')} className="p-2 bg-white border border-slate-200 rounded-lg text-sm cursor-pointer hover:border-brand-300 hover:text-brand-600 flex justify-between items-center"><span>{field.label}</span><Icons.ArrowRight size={14}/></div>))}</div></div>
                                    <div className="flex-1 border border-brand-200 rounded-xl overflow-hidden flex flex-col bg-brand-50/30"><div className="bg-brand-100 p-2 text-xs font-bold text-brand-700 text-center uppercase">Asignados</div><div className="p-2 space-y-1 overflow-y-auto">{assignedFields.map(field => (<div key={field.id} onClick={() => moveField(field, 'toLeft')} className="p-2 bg-white border border-brand-200 rounded-lg text-sm font-medium text-brand-800 cursor-pointer hover:bg-red-50 hover:text-red-600 flex justify-between items-center"><Icons.ArrowLeft size={14}/><span>{field.label}</span></div>))}</div></div>
                                </div>
                            </div>
                        </div>
                        <div className="mt-8 pt-6 border-t border-slate-100 flex justify-end gap-3"><Button variant="ghost" onClick={() => setEditType(null)}>Cancelar</Button><Button variant="primary" onClick={handleUpdate}><Icons.Save size={18}/> Guardar Cambios</Button></div>
                    </Card></div>}

                    {deleteType && <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50"><Card className="w-96 text-center animate-scaleIn"><div className="mx-auto bg-red-100 w-16 h-16 rounded-full flex items-center justify-center text-red-600 mb-4"><Icons.AlertTriangle size={32}/></div><h3 className="font-bold text-lg">¿Eliminar {deleteType.name}?</h3><div className="mt-6 flex justify-center gap-2"><Button variant="ghost" onClick={() => setDeleteType(null)}>Cancelar</Button><Button variant="danger" onClick={handleDeleteConfirm}>Eliminar</Button></div></Card></div>}
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('repository');
            const [isAdminMenuOpen, setIsAdminMenuOpen] = useState(false);
            const [documents, setDocuments] = useState([
                { id: 'RES-2026-0001', title: 'Resolución Ministerial 45/2026', type: 'Resolución', keyword: 'Presupuesto', author: 'Rodrigo Antola', date: '2026-02-02', institution: 'Ministerio de Hacienda', status: 'Activo', digitaliaId: 'EXP-9923' },
                { id: 'INF-2026-0001', title: 'Informe Técnico Auditoría', type: 'Informe Técnico', keyword: 'Auditoría 2025', author: 'Cynthia Gonzalez', date: '2026-02-01', institution: 'Auditoría General', status: 'Inactivo', digitaliaId: null }
            ]);

            return (
                <div className="flex h-screen bg-slate-100 font-sans text-slate-900 animate-fadeIn">
                    <div className="w-64 bg-slate-900 text-white flex flex-col shadow-xl z-20">
                        <div className="p-6 border-b border-slate-800"><div className="flex items-center space-x-3"><div className="bg-white/10 p-2 rounded-lg"><Icons.Building size={24} className="text-blue-400" /></div><div><h1 className="font-bold text-lg leading-tight">Gestión Documental</h1><p className="text-xs text-slate-400">Gobierno Nacional</p></div></div></div>
                        <nav className="flex-1 py-6 space-y-1">
                            <SidebarItem id="repository" icon="FolderOpen" label="Repositorio" active={activeTab === 'repository'} onClick={setActiveTab} />
                            <SidebarItem id="create" icon="Plus" label="Nuevo Documento" active={activeTab === 'create'} onClick={setActiveTab} />
                            <SidebarItem id="my_documents" icon="User" label="Mi Dependencia" active={activeTab === 'my_documents'} onClick={setActiveTab} />
                            <SidebarItem id="validate" icon="Shield" label="Validar Documento" active={activeTab === 'validate'} onClick={setActiveTab} />
                            <SidebarItem id="integration" icon="LinkIcon" label="Relacionar a Expedientes" active={activeTab === 'integration'} onClick={setActiveTab} />
                            <div><button onClick={() => setIsAdminMenuOpen(!isAdminMenuOpen)} className="w-full flex items-center justify-between px-4 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white"><div className="flex items-center space-x-3"><Icons.Settings size={20} /><span>Administración</span></div>{isAdminMenuOpen ? <Icons.ChevronDown size={16} /> : <Icons.ChevronRight size={16} />}</button>{isAdminMenuOpen && <div className="bg-slate-950 py-1"><button onClick={() => setActiveTab('admin_types')} className="w-full flex items-center space-x-3 pl-12 pr-4 py-2 text-sm font-medium text-slate-500 hover:text-white"><span>Tipos de Documento</span></button></div>}</div>
                        </nav>
                        <div className="p-4 bg-slate-800 m-4 rounded-xl flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="bg-blue-500 rounded-full p-1"><Icons.User size={14} className="text-white" /></div>
                                <div><p className="text-sm font-medium">Cynthia Gonzalez</p><p className="text-xs text-slate-400">Analista</p></div>
                            </div>
                        </div>
                    </div>
                    <div className="flex-1 flex flex-col overflow-hidden">
                        <header className="bg-white shadow-sm border-b border-slate-200 px-8 py-4 flex justify-between items-center z-10"><div><h2 className="text-xl font-semibold text-slate-800">{activeTab === 'repository' ? 'Bandeja de Documentos' : activeTab === 'my_documents' ? 'Mi Dependencia' : activeTab === 'create' ? 'Generación de Documentos' : activeTab === 'validate' ? 'Validación Pública' : activeTab === 'integration' ? 'Interoperabilidad' : 'Administración'}</h2></div><div className="flex items-center space-x-4"><div className="text-right hidden md:block"><p className="text-xs text-slate-500">Última sincronización</p><p className="text-sm font-medium text-slate-700">Hoy, 10:00 AM</p></div></div></header>
                        <main className="flex-1 overflow-auto p-8">
                            {activeTab === 'repository' && <RepositoryView setActiveTab={setActiveTab} documents={documents} setDocuments={setDocuments} />}
                            {activeTab === 'my_documents' && <RepositoryView setActiveTab={setActiveTab} documents={documents} setDocuments={setDocuments} onlyUserDocs={true} />}
                            {activeTab === 'create' && <CreateDocumentView setActiveTab={setActiveTab} documents={documents} setDocuments={setDocuments} />}
                            {activeTab === 'validate' && <ValidateDocumentView />}
                            {activeTab === 'integration' && <IntegrationView documents={documents} />}
                            {activeTab === 'admin_types' && <AdminTypesView />}
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
